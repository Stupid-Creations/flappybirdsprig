/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Flappy Bird!
@author: 
@tags: []
@addedOn: 2024-00-00
*/

const player = "p";
const pipe = "P";
const tail = "T";

setLegend(
  [ player, bitmap`
................
................
................
....0000000.....
..0066660220....
..06666012020...
.000666012020...
0222066601220...
01222066600000..
011220660999990.
.0010660900000..
..006666099990..
...0066660000...
.....0000.......
................
................`], [pipe, bitmap`
................
..004444444400..
..00D444424400..
..00D444424400..
..00DD44442400..
..000000000000..
...0000000000...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...`], [tail,bitmap`
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...
...0DD4444440...`] 
);



let level = 0
const levels = [
  map`
.....
.....
.....
p....
.....
.....
.....
.....
.....`
]

setMap(levels[level])

const spawnPipes = () => {
  console.log('a')
  yes = Math.random(0,1);
  if(yes > 0.3){
    ch2ser = Math.random(0,1);
    if (ch2ser > 0.5){
      y = 8 - Math.round(Math.random(0,4));
    }else{
      y = 0 + Math.round(Math.random(0,4));
    }
        addSprite(4,y,pipe);
    if (y > 0 && y < 3){
      for(i = 0; i < y; i++){
        addSprite(4,i,tail);
      }
    }else
    if(y < 8 && y > 2){
              console.log("ouch")

      for(j = 8; j < y; j --){
        addSprite(4,j,tail);
      }
    }
  }
}

const updatePipes = () => {
   console.log(getAll(pipe))
   console.log('b')
  if(getAll(pipe).length > 0){
  for(i = 0; i < getAll(pipe).length;i ++){
    if(getAll(pipe)[i].x === 0){
      getAll(pipe)[i].remove();
    }
    getAll(pipe)[i].x -= 1;
  }
  }
  if(getAll(tail).length > 0){
  for(j = 0; j < getAll(tail).length;j ++){
    if(getAll(tail)[j].x === 0){
      getAll(tail)[j].remove();
    }
    getAll(tail)[j].x -= 1;
  }
  }
}

setInterval(updatePipes,1000);
setInterval(spawnPipes,1000);

setPushables({
  [ player ]: []
})

onInput("s", () => {
  getFirst(player).y += 1
})

afterInput(() => {
  
})
